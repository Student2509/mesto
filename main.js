(()=>{"use strict";var t=document.querySelector(".profile__button-edit"),e=document.querySelector(".profile__button-add"),n=document.querySelector(".profile__change-avatar"),r=document.querySelector("#popUpEdit"),o=r.querySelector(".popup__form"),i=r.querySelector(".popup__edit-line_field_name"),u=r.querySelector(".popup__edit-line_field_description"),l=document.querySelector("#popUpAdd").querySelector(".popup__form"),c=(document.querySelector("#popUpPicture"),document.querySelector("#popUpAvatar").querySelector(".popup__form")),a={formSelector:".popup__form",inputSelector:".popup__edit-line",submitButtonSelector:".popup__button-submit",inactiveButtonClass:"popup__button-submit_non-active",inputErrorClass:"popup__edit-line_incorrect",errorClass:"popup__edit-line-error"};function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==s(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===s(o)?o:String(o)),r)}var o}var p=function(){function t(e){var n=e.card,r=e.templateSelector,o=e.handleClick,i=e.handleDelete,u=e.handleLike;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._card=n,this._templateSelector=r,this._handleClick=o,this._handleDelete=i,this._handleLike=u,this._ownerId=""}var e,n;return e=t,(n=[{key:"_enableDeleteButton",value:function(){this._elementItem.querySelector(".elements__delete").classList.remove("elements__delete_disabled")}},{key:"_showActiveLikes",value:function(){var t=this._elementItem.querySelector(".elements__like");t.classList.contains("elements__like-active")||t.classList.add("elements__like-active")}},{key:"setOwnerId",value:function(t){this._ownerId=t}},{key:"_checkOwner",value:function(){var t=this;this._card.owner._id===this._ownerId&&this._enableDeleteButton(),this._card.likes.some((function(e){e._id,t._ownerId}))&&this._showActiveLikes()}},{key:"setLikes",value:function(t){this._likesElement.textContent=t}},{key:"_getTemplate",value:function(){return document.querySelector(this._templateSelector).content.querySelector(".elements__item").cloneNode(!0)}},{key:"_setEventListeners",value:function(){var t=this;this._elementItemPicture.addEventListener("click",(function(){t._handleClick(t._card.name,t._card.link)})),this._elementItem.querySelector(".elements__like").addEventListener("click",(function(e){t._handleLike(e,t)})),this._elementItem.querySelector(".elements__delete").addEventListener("click",(function(e){t._handleDelete(e,t._card._id)}))}},{key:"generate",value:function(){return this._elementItem=this._getTemplate(),this._elementItemPicture=this._elementItem.querySelector(".elements__picture"),this._elementItemPicture.src=this._card.link,this._elementItemPicture.alt="Изображение: "+this._card.name,this._elementItem.querySelector(".elements__title").textContent=this._card.name,this._likesElement=this._elementItem.querySelector(".elements__like-count"),this._likesElement.textContent=this._card.likes?this._card.likes.length:0,this._checkOwner(),this._setEventListeners(),this._elementItem}}])&&f(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function m(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,d(r.key),r)}}function b(t,e,n){return e&&m(t.prototype,e),n&&m(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function h(t,e,n){return(e=d(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d(t){var e=function(t,e){if("object"!==y(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===y(e)?e:String(e)}var v=b((function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),h(this,"_showInputError",(function(t,e){var n=r._formElement.querySelector(".".concat(t.id,"-error"));t.classList.add(r._settings.inputErrorClass),n.textContent=e,n.classList.add(r._settings.errorClass)})),h(this,"_hideInputError",(function(t){var e=r._formElement.querySelector(".".concat(t.id,"-error"));t.classList.remove(r._settings.inputErrorClass),e.classList.remove(r._settings.errorClass),e.textContent=""})),h(this,"_hasInvalidInput",(function(){return r._inputList.some((function(t){return!t.validity.valid}))})),h(this,"toggleButtonState",(function(){r._hasInvalidInput()?(r._buttonElement.classList.add(r._settings.inactiveButtonClass),r._buttonElement.disabled=!0):(r._buttonElement.classList.remove(r._settings.inactiveButtonClass),r._buttonElement.disabled=!1)})),h(this,"_checkInputValidity",(function(t){t.validity.valid?r._hideInputError(t):r._showInputError(t,t.validationMessage)})),h(this,"_setEventListeners",(function(){r._inputList=Array.from(r._formElement.querySelectorAll(r._settings.inputSelector)),r._buttonElement=r._formElement.querySelector(r._settings.submitButtonSelector),r.toggleButtonState(r._inputList),r._inputList.forEach((function(t){t.addEventListener("input",(function(){r._checkInputValidity(t),r.toggleButtonState(r._inputList)}))}))})),h(this,"enableValidation",(function(){r._setEventListeners(r._formElement,r._settings)})),this._settings=e,this._formElement=n}));function _(t){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_(t)}function S(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==_(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===_(o)?o:String(o)),r)}var o}var g=function(){function t(e,n){var r=e.renderer;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._renderer=r,this._container=document.querySelector(n)}var e,n;return e=t,(n=[{key:"addItem",value:function(t){this._container.prepend(t)}},{key:"_clear",value:function(){this._container.innerHTML=""}},{key:"renderItems",value:function(t){var e=this;this._clear(),t.forEach((function(t){e._renderer(t)}))}}])&&S(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}function k(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==w(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==w(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===w(o)?o:String(o)),r)}var o}var E=function(){function t(e){var n=e.nameSelector,r=e.descriptionSelector,o=e.avatarSelector;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._profileTitle=document.querySelector(n),this._profileSubtitle=document.querySelector(r),this._profileAvatar=document.querySelector(o),this._id=""}var e,n;return e=t,(n=[{key:"getUserInfo",value:function(){return{profileTitle:this._profileTitle.textContent,profileSubtitle:this._profileSubtitle.textContent}}},{key:"getUserId",value:function(){return this._id}},{key:"setUserId",value:function(t){this._id=t}},{key:"setUserInfo",value:function(t){var e=t.name,n=t.description,r=t.avatar;this._profileTitle.textContent=e,this._profileSubtitle.textContent=n,this._profileAvatar.src=r}}])&&k(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function P(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==O(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==O(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===O(o)?o:String(o)),r)}var o}var j=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._popup=document.querySelector(e),this._buttonClose=this._popup.querySelector(".popup__button-close"),this._handleEscClose=this._handleEscClose.bind(this)}var e,n;return e=t,(n=[{key:"open",value:function(){document.addEventListener("keydown",this._handleEscClose),this._popup.classList.add("popup_opened")}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"_handleEscClose",value:function(t){"Escape"===t.key&&this.close()}},{key:"setEventListeners",value:function(){this._buttonClose.addEventListener("click",this.close.bind(this)),this._popup.addEventListener("click",this._handleCloseByClickOutside.bind(this))}},{key:"_handleCloseByClickOutside",value:function(t){t.target.classList.contains("popup")&&this.close()}}])&&P(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function C(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==L(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==L(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===L(o)?o:String(o)),r)}var o}function I(){return I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=A(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},I.apply(this,arguments)}function T(t,e){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},T(t,e)}function A(t){return A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},A(t)}var q=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&T(t,e)}(u,t);var e,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=A(r);if(o){var n=A(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===L(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function u(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(n=i.call(this,t))._handleFormSubmit=e,n._popupForm=n._popup.querySelector(".popup__form"),n._buttonSubmit=n._popupForm.querySelector(".popup__button-submit"),n._inputList=n._popupForm.querySelectorAll(".popup__edit-line"),n._buttonSubmitDefaultTitle=n._buttonSubmit.textContent,n}return e=u,(n=[{key:"close",value:function(){I(A(u.prototype),"close",this).call(this),this._popupForm.reset()}},{key:"_getInputValues",value:function(){var t=this;return this._formValues={},this._inputList.forEach((function(e){t._formValues[e.name]=e.value})),this._formValues}},{key:"setEventListeners",value:function(){var t=this;I(A(u.prototype),"setEventListeners",this).call(this),this._popupForm.addEventListener("submit",(function(e){t._handleFormSubmit(e,t._getInputValues())}))}},{key:"toggleAwaitingState",value:function(){var t=this._buttonSubmit.textContent,e="";switch(this._buttonSubmitDefaultTitle){case"Сохранить":e="Сохранение...";break;case"Создать":e="Создание...";break;case"Да":e="Удаление...";break;default:e="Выполнение..."}this._buttonSubmit.textContent.includes("...")?this._buttonSubmit.textContent=this._buttonSubmitDefaultTitle:this._buttonSubmit.textContent=e,console.log("changing from ".concat(t," to ").concat(this._buttonSubmit.textContent))}}])&&C(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),u}(j);function U(t){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U(t)}function x(t,e){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},x(t,e)}function R(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function D(){return D="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=B(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},D.apply(this,arguments)}function B(t){return B=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},B(t)}function F(t){var e=function(t,e){if("object"!==U(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==U(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===U(e)?e:String(e)}var V=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&x(t,e)}(i,t);var e,n,r,o=(n=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=B(n);if(r){var o=B(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===U(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return R(t)}(this,t)});function i(t){var e,n,r,u,l;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),r=R(n=o.call(this,t)),l=function(t,r){n._popupImage.src=t,n._popupTitle.textContent=r,n._popupImage.alt="Изображение: "+r,D((e=R(n),B(i.prototype)),"open",e).call(e)},(u=F(u="open"))in r?Object.defineProperty(r,u,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[u]=l,n._popupImage=n._popup.querySelector(".popup__image-picture"),n._popupTitle=n._popup.querySelector(".popup__image-title"),n}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(j);function N(t){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N(t)}function H(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==N(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==N(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===N(o)?o:String(o)),r)}var o}var J=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._tokenNumber=e,this._cohortNumber=n,this._apiURL=r,this._fullApiUrl="".concat(this._apiURL).concat(this._cohortNumber,"/"),this._headers={authorization:this._tokenNumber,"Content-Type":"application/json"}}var e,n;return e=t,(n=[{key:"_handleApi",value:function(t){return t.ok?t.json():Promise.reject("Ошибка в получении данных. Код: ".concat(t.status,", описание: ").concat(t.statusText))}},{key:"getUserInfo",value:function(){var t=this;return fetch("".concat(this._fullApiUrl,"users/me"),{headers:this._headers}).then((function(e){return t._handleApi(e)}))}},{key:"getInitialCards",value:function(){var t=this;return fetch("".concat(this._fullApiUrl,"cards"),{headers:this._headers}).then((function(e){return t._handleApi(e)}))}},{key:"editProfileInfo",value:function(t){var e=this;return fetch("".concat(this._fullApiUrl,"users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify(t)}).then((function(t){return e._handleApi(t)}))}},{key:"addCard",value:function(t){var e=this,n=t.newName,r=t.newLink;return fetch("".concat(this._fullApiUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:n,link:r})}).then((function(t){return e._handleApi(t)}))}},{key:"likeCard",value:function(t,e){var n=this;return fetch("".concat(this._fullApiUrl,"/cards/").concat(t,"/likes"),{method:e?"DELETE":"PUT",headers:this._headers}).then((function(t){return n._handleApi(t)}))}},{key:"deleteCard",value:function(t){var e=this;return fetch("".concat(this._fullApiUrl,"/cards/").concat(t),{method:"DELETE",headers:this._headers}).then((function(t){return e._handleApi(t)}))}},{key:"setUserAvatar",value:function(t){var e=this;return fetch("".concat(this._fullApiUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify(t)}).then((function(t){return e._handleApi(t)}))}}])&&H(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function M(t){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M(t)}function z(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==M(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==M(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===M(o)?o:String(o)),r)}var o}function G(){return G="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Q(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},G.apply(this,arguments)}function K(t,e){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},K(t,e)}function Q(t){return Q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Q(t)}var W=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&K(t,e)}(u,t);var e,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Q(r);if(o){var n=Q(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===M(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function u(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(n=i.call(this,t))._handleFormSubmit=e,n._popupForm=n._popup.querySelector(".popup__form"),n._buttonSubmit=n._popupForm.querySelector(".popup__button-submit"),n._buttonSubmitDefaultTitle=n._buttonSubmit.textContent,n._buttonSubmitAwaitingText="Удаление...",n}return e=u,(n=[{key:"close",value:function(){G(Q(u.prototype),"close",this).call(this),this._popupForm.reset()}},{key:"getForm",value:function(){return this._popupForm}},{key:"setEventListeners",value:function(){var t=this;G(Q(u.prototype),"setEventListeners",this).call(this),this._popupForm.addEventListener("submit",(function(e){t._handleFormSubmit(e)}))}},{key:"toggleAwaitingState",value:function(){this._buttonSubmit.textContent.includes("...")?this._buttonSubmit.textContent=this._buttonSubmitDefaultTitle:this._buttonSubmit.textContent=this._buttonSubmitAwaitingText}}])&&z(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),u}(j),X=new J("b21d8a3b-b2ca-438c-885d-b991cee86b64","cohort-65","https://mesto.nomoreparties.co/v1/"),Y=new v(a,o),Z=new v(a,l),$=new v(a,c);Y.enableValidation(),Z.enableValidation(),$.enableValidation();var tt=new g({renderer:function(t){var e=lt(t);tt.addItem(e)}},".elements"),et=new E({nameSelector:".profile__title",descriptionSelector:".profile__subtitle",avatarSelector:".profile__avatar"});Promise.all([X.getUserInfo(),X.getInitialCards()]).then((function(t){var e=t[0],n=t[1];et.setUserInfo({name:e.name,description:e.about,avatar:e.avatar}),et.setUserId(e._id),tt.renderItems(n)})).catch((function(t){return console.log("Ошибка: ".concat(t))}));var nt=new q("#popUpEdit",(function(t,e){t.preventDefault(),nt.toggleAwaitingState(),X.editProfileInfo({name:e.name,about:e.description}).then((function(t){et.setUserInfo({name:t.name,description:t.about,avatar:t.avatar}),nt.close()})).catch((function(t){return console.log("Ошибка: ".concat(t))})).finally((function(){nt.toggleAwaitingState()}))}));nt.setEventListeners(),t.addEventListener("click",(function(){var t=et.getUserInfo(),e=t.profileTitle,n=t.profileSubtitle;i.value=e,u.value=n,Y.toggleButtonState(),nt.open()}));var rt=new q("#popUpAdd",(function(t,e){t.preventDefault(),rt.toggleAwaitingState(),X.addCard({newName:e.name,newLink:e.description}).then((function(t){var e=lt(t);tt.addItem(e),rt.close()})).catch((function(t){return console.log("Ошибка: ".concat(t))})).finally((function(){rt.toggleAwaitingState()}))}));rt.setEventListeners(),e.addEventListener("click",(function(){Z.toggleButtonState(),rt.open()}));var ot=new V("#popUpPicture");ot.setEventListeners();var it=new W("#popUpDelete",(function(t){t.preventDefault()}));it.setEventListeners();var ut=new q("#popUpAvatar",(function(t,e){t.preventDefault(),ut.toggleAwaitingState(),X.setUserAvatar({avatar:e.avatar}).then((function(t){et.setUserInfo({name:t.name,description:t.about,avatar:t.avatar}),ut.close(),$.toggleButtonState()})).catch((function(t){return console.log("Ошибка: ".concat(t))})).finally((function(){ut.toggleAwaitingState()}))}));function lt(t){var e=new p({card:t,templateSelector:".elements__template",handleClick:ct,handleDelete:st,handleLike:function(e,n){var r=e.target.classList.contains("elements__like-active");X.likeCard(t._id,r).then((function(t){var r;r=t.likes?t.likes.length:0,console.log(n),n.setLikes(r),e.target.classList.toggle("elements__like-active")})).catch((function(t){return console.log("Ошибка: ".concat(t))}))}});return e.setOwnerId(et.getUserId()),e.generate()}function ct(t,e){ot.open(e,t)}ut.setEventListeners(),n.addEventListener("click",(function(){ut.open()}));var at={id:"",evt:"",form:""},st=function(t,e){at.id=e,at.evt=t,t.preventDefault(),it.open();var n=it.getForm();at.form=n,n.removeEventListener("submit",ft),n.addEventListener("submit",ft)},ft=function t(){it.toggleAwaitingState(),X.deleteCard(at.id).then((function(){at.evt.target.closest(".elements__item").remove(),it.close(),at.form.removeEventListener("submit",t)})).catch((function(t){return console.log("Ошибка: ".concat(t))})).finally((function(){it.toggleAwaitingState()}))}})();